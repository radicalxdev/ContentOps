tasks:
  - name: "Introduction and Setup"
    context: "In this mission, learners focus on improving code security using GitHub Copilot Chat. They start by understanding the importance of code security and the measures to protect software from unauthorized access, data breaches, and other threats. The learning objectives include collaborating with Copilot to enhance code security and implementing security features such as rate limiting. Learners are guided to prepare the repository by cloning it from GitHub, creating environment files, and activating the shell script to set up the development or production environment. This setup prepares them for the upcoming exercises where they will use Copilot Chat to generate and evaluate suggestions for improving code security."
    id: "1"
    nodes:
      - id: START
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Hello, {userName}! Welcome to the 'Improve Code Security with GitHub Copilot Chat' mission. This training focuses on using GitHub Copilot Chat to generate suggestions for improving code security in a sample application. Remember, the suggestions from Copilot do not represent best practices or comprehensive solutions. Use your judgment and expertise to evaluate and implement these suggestions. Ready to start?
        edges:
          - text: "Yes, let's get started!"
            target_node_id: "END"
          - text: "Tell me more about the objectives."
            target_node_id: "screen1a"
          - text: "What do you mean by Code Security?"
            target_node_id: "screen1b"

      - id: screen1a
        type: message
        body:
          parts:
            - type: "text"
              content: |
                In this mission, you'll use GitHub Copilot to generate suggestions that help improve code security in a sample application. Code security refers to the measures taken to protect software from unauthorized access, data breaches, and other security threats. Improving your code security can help you protect your applications and systems from security threats.
            - type: "text"
              content: |
                The learning objectives are:
                - Demonstrate how to collaborate with Copilot to enhance code security.
                - Use Copilot to implement security features such as rate limiting.
            - type: "text"
              content: "Ready to proceed?"
        edges:
          - text: "Yes, let's move on!"
            target_node_id: "END"
          - text: "What do you mean by Code Security?"
            target_node_id: "screen1b"

      - id: screen1b
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Code security refers to the measures taken to protect software from unauthorized access, data breaches, and other security threats. Code security is an essential aspect of software development that involves protecting applications and systems from security threats. Improving your code security can help you to protect your applications and systems from security threats.

                In this exercise, you'll use GitHub Copilot Chat to generate suggestions that help you improve code security in a sample application.
        edges:
          - text: "Got it!"
            target_node_id: "END"

      - id: END
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Let's prepare the repository for this exercise. Follow these steps:
                1. Clone the GitHub repository found at: https://github.com/alfred-ai-co/Improve-Code-Quality-with-Copilot
                2. Create a `dev.env` and `prod.env` file based on the `env.example`, setting the variable `APP_ENV` to “dev” or “prod” respectively.
                3. In the terminal, activate the shell script `start.sh` with the command: `/start.sh <args>`, where you may set `dev` or `prod` as the argument. By default, a `dev` environment is instantiated.
            - type: "text"
              content: "Ready to continue?"

  - name: "General Security Improvements with Copilot Chat"
    context: "In this segment of the mission, learners begin to develop prompts for GitHub Copilot Chat to improve the security of their code. They start by entering a general prompt to get broad security improvement suggestions. After examining Copilot's response, which provides an overview of potential security enhancements, learners prepare to delve deeper into specific security measures, such as implementing rate limiting in the application. This step sets the stage for targeted security improvements using Copilot's suggestions."
    id: "2"
    nodes:
      - id: START
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Let's begin by developing a prompt that provides the needed context for Copilot. Start with general workspace prompts to narrow down our results into actionable suggestions. Enter the following prompt:
                
                ```python
                @workspace /explain how can I improve the security of my code?
                ```
            - type: "text"
              content: "Ready to proceed?"
        edges:
          - text: "Command entered!"
            target_node_id: "END"

      - id: END
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Examine Copilot's response regarding the application as a whole. You might see general suggestions for improving security. We'll explore in more detail how to add **rate limiting** to the application.
            - type: "image"
              content: "https://file.notion.so/f/f/43a92826-71a1-4057-8884-809bc640049f/b07e5041-a36a-4e86-8c53-03493d8296d1/Untitled.png?id=698939c3-e07b-4f03-82fb-a1b90d867943&table=block&spaceId=43a92826-71a1-4057-8884-809bc640049f&expirationTimestamp=1721764800000&signature=o8jqdpBWLnnnVIRDOdF8kDzWf-lKrXv0Rg1lKM3SsCM&downloadName=Untitled.png"
            - type: "text"
              content: "Ready to explore implementing rate limiting?"

  - name: "Implementing Rate Limiting"
    context: "In this segment of the mission, learners begin to develop prompts for GitHub Copilot Chat to improve the security of their code. They start by entering a general prompt to get broad security improvement suggestions. After examining Copilot's response, which provides an overview of potential security enhancements, learners prepare to delve deeper into specific security measures, such as implementing rate limiting in the application. This step sets the stage for targeted security improvements using Copilot's suggestions."
    id: "3"
    nodes:
      - id: START
        type: message
        body:
          parts:
            - type: "text"
              content: |
                To introduce rate limiting to the API, let's ask Copilot how to implement it. Enter the following prompt:
                
                ```python
                @workspace /explain How do I implement rate limiting in the FastAPI application?
                ```
            - type: "text"
              content: "Ready to proceed?"
        edges:
          - text: "Command entered!"
            target_node_id: "screen4a"

      - id: screen4a
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Review Copilot's response about introducing rate limiting to the application. Pay attention to the suggested library and the example provided.
            - type: "image"
              content: "[Link to Screenshot showing Copilot's response about rate limiting.]"
            - type: "text"
              content: "Ready to proceed?"
        edges:
          - text: "Yes, let's continue!"
            target_node_id: "screen4b"

      - id: screen4b
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Now, let's ask Copilot for a specific implementation strategy. Use the following prompt:
                
                ```python
                @workspace How can we further implement the rate limiter in #file:main.py and then apply the limiter within each route as part of the router such as #file:projects.py given the file structure?
                ```
            - type: "text"
              content: "Ready to proceed?"
        edges:
          - text: "Command entered!"
            target_node_id: "screen4c"

      - id: screen4c
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Examine Copilot's response about introducing rate limiting to the application as a whole. This can give us a direction of where to go next. We should pay attention to the suggested library and the example provided about how it would work within our app. This helps us consider the feasibility of the suggestion.
            - type: "image"
              content: "https://file.notion.so/f/f/43a92826-71a1-4057-8884-809bc640049f/c18431a8-3b59-4594-a41e-f851acbdbf68/Untitled.png?id=5beeae12-cf8e-4375-b9b1-7810bdbc7d75&table=block&spaceId=43a92826-71a1-4057-8884-809bc640049f&expirationTimestamp=1721764800000&signature=Mm4pt3Nb2hPN4j30Az594pK39ws-3vjE8rRXh65uhP4&downloadName=Untitled.png"
            - type: "text"
              content: "Ready to review an implemented solution?"
        edges:
          - text: "Yes, let's proceed!"
            target_node_id: "screen5"

      - id: screen5
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Let's finally drill down to a very specific implementation by passing this prompt:
                ```
                @workspace How can we further implement the rate limiter to the #file:main.py and then apply the limiter within each route as part of the router such as #file:projects.py given the file structure
                ```
                Once sent, take a minute to review the response.
        edges:
          - text: "Yes, let's proceed!"
            target_node_id: "screen5a"

      - id: screen5a
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Examine Copilot's implementation. In our case, the actual implementation involves several steps such as moving the logic of the limiter to a separate file within the core/ folder. We can instantiate this as an attribute to the app within the main.py folder and then import the app.core.limiter module to create a decorator @limiter.limit('5/minute') on top of the routes.
            - type: "image"
              content: "https://file.notion.so/f/f/43a92826-71a1-4057-8884-809bc640049f/711cc49b-74db-4ea7-8654-5f2e98700b89/Untitled.png?id=553e9267-8b3b-4d1b-b550-63e431ba3a6c&table=block&spaceId=43a92826-71a1-4057-8884-809bc640049f&expirationTimestamp=1721764800000&signature=22LXyKErRlDMMUEAB5_GNg7wLo81qDiq-hXWJDnZO5o&downloadName=Untitled.png"
            - type: "text"
              content: "Ready to review an implemented solution?"
        edges:
          - text: "Show me an implementation."
            target_node_id: "screen6"

      - id: screen6
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Let's examine an implemented rate limit solution. Use git to switch to the `feat/add_rate_limits` branch to see a working implementation. This will help you compare your solution with an example implementation. The command would be `git switch feat/add_rate_limits`.
            - type: "text"
              content: |
                Feel free to also use the `@workspace` command to review the code for adding the rate limits. We can test the solution works by starting the server and then sending a request to the API from the /docs page.
            - type: "image"
              content: "https://file.notion.so/f/f/43a92826-71a1-4057-8884-809bc640049f/f957c22a-fa4f-4f98-88d0-9eda6b422586/Untitled.png?id=6ff18360-af8d-4d0a-8c2b-13b218101cbc&table=block&spaceId=43a92826-71a1-4057-8884-809bc640049f&expirationTimestamp=1721764800000&signature=L3DYz5uqZmGjt0s48mqT4rE9S6t-7BoogPdDWOLSSZA&downloadName=Untitled.png"
            - type: "text"
              content: "Let's wrap up!"
        edges:
          - text: "Okay, let's wrap up!"
            target_node_id: "END"

      - id: END
        type: message
        body:
          parts:
            - type: "text"
              content: |
                Here is a summary of what we've learned:
                - Used Copilot to generate suggestions for improving code security.
                - Focused on implementing rate limiting to enhance security.
                - Reviewed and compared your implementation with an example solution.
            - type: "text"
              content: |
                Congratulations, {username}! 🎉 You've successfully used GitHub Copilot Chat to generate suggestions and implement a security feature in your code. This exercise demonstrated how to interact with Copilot to enhance code security, focusing on implementing rate limiting. Remember, always review and assess the suggestions before implementing them.